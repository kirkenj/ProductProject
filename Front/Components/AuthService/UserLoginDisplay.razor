@using Front.Models
@using Front.Services
@inject CustomAuthStateProvider authStateProvider

@(DisplayName ?? "Unauthorized")

@code {
    private string? DisplayName { get; set; }

    protected override async void OnInitialized()
    {
        authStateProvider.AuthenticationStateChanged += AuthStateChanged;
        base.OnInitialized();
        DisplayName = authStateProvider.CurrentUser?.Name;
    }


    private async void AuthStateChanged(Task<AuthenticationState> authenticationState)
    {
        var res = await authenticationState;
        
        try
        {
            var user = User.FromClaimsPrincipal(res.User);
            DisplayName = user.Name;
        }
        catch
        {
            DisplayName = null;
        }

        StateHasChanged();
    }
}
